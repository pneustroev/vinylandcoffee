<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Список продуктов</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0A7374">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0A7374 0%, #F37121 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .tabs {
            display: flex;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            user-select: none;
        }

        .tab.active {
            background: rgba(0,0,0,0.2);
            font-weight: bold;
        }

        .container {
            padding: 15px;
            margin: 10px;
            background: white;
            border-radius: 12px;
        }

        .search-container input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #ddd;
            font-size: 16px;
        }

        .products-list {
            max-height: 55vh;
            overflow-y: auto;
            margin-top: 10px;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 6px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .product-header {
            background: #e0e0e0 !important;
            color: #555 !important;
            font-weight: bold;
            pointer-events: none;
        }

        .product-item input[type="checkbox"] {
            margin-right: 12px;
        }

        .selected-block {
            margin-top: 20px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }

        .buttons {
            margin: 12px 0;
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            background: #0A7374;
            color: white;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn.clear {
            background: #F37121;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 18px;
            background: rgba(0,0,0,0.85);
            color: white;
            border-radius: 20px;
            opacity: 0;
            transition: 0.3s;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>

<body>

<div class="tabs">
    <div class="tab active" onclick="switchTab('kitchen')">Кухня</div>
    <div class="tab" onclick="switchTab('bar')">Бар</div>
</div>

<div id="kitchen" class="container">
    <div class="search-container">
        <input type="text" id="searchKitchen" placeholder="Поиск..." oninput="filterProducts('kitchen')">
    </div>

    <div id="listKitchen" class="products-list"></div>

    <div class="buttons">
        <div class="btn" onclick="copySelected('kitchen')">Копировать</div>
        <div class="btn clear" onclick="clearAll('kitchen')">Очистить</div>
    </div>

    <div class="selected-block">
        <h3>Выбранные продукты:</h3>
        <div id="selectedKitchen">Нет выбранных продуктов</div>
    </div>
</div>

<div id="bar" class="container" style="display:none;">
    <div class="search-container">
        <input type="text" id="searchBar" placeholder="Поиск..." oninput="filterProducts('bar')">
    </div>

    <div id="listBar" class="products-list"></div>

    <div class="buttons">
        <div class="btn" onclick="copySelected('bar')">Копировать</div>
        <div class="btn clear" onclick="clearAll('bar')">Очистить</div>
    </div>

    <div class="selected-block">
        <h3>Выбранные продукты:</h3>
        <div id="selectedBar">Нет выбранных продуктов</div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>

// === КАТЕГОРИИ КУХНИ ===

// Продстар
const kitchenProdstar = [
"Майонез",
"Кунжутное масло",
"Горчица",
"Мед",
"Клюква",
"Вишня",
"Сливки 33%",
"Сметана",
"Моцарелла",
"Чеддер",
"Творожный сыр",
"Сгущенка",
"Яйца",
"Бекон",
"Ветчина",
"Мортаделла",
"Куриная грудка",
"Мука",
"Крахмал",
"Грецкие орехи",
"Миндальные лепестки",
"Семена тыквы",
"Сахарная пудра",
"Вяленые томаты",
"Индейка филе",
"Ананасы кольца",
"Растительное масло"
];

// Купер
const kitchenKuper = [
"Белый шоколад",
"Паприка",
"Жидкий дым",
"Авокадо",
"Банан",
"Груша",
"Помидоры",
"Огурцы",
"Микрозелень",
"Айсберг",
"Фрилис",
"Форель",
"Картофельные хлопья",
"Печенье шоколадное",
"Разрыхлитель",
"Семена льна",
"Мороженое",
"Корица",
"Приправа для курицы",
"Соль",
"Черный перец",
"Сливочное масло",
"Лимонный сок",
"Сахар",
"Приправа Карри",
"Лимоны",
"Лук фри"
];

// Продукты на суп
const kitchenSoup = [
"Картофель",
"Горох",
"Кубики куриный",
"Кубики говяжий",
"Петрушка суш",
"Зажарка",
"Колбаса в гороховый",
"Курица супная",
"Лапша яичная",
"Чечевица",
"Перец болгарский",
"Томатная паста",
"Фета",
"Свинина",
"Капуста",
"Морковь"
];


// === КАТЕГОРИИ БАРА ===

// Купер (строго заданный список)
const barKuper = [
"Апельсин",
"Варенье малина",
"Варенье черника",
"Гранатовый сок",
"Мед цветочный",
"Мята",
"Сахар рафинад",
"Сок апельсиновый",
"Сок вишня",
"Сок грейпфрут",
"Халва воздушная",
"Корица"
];

// Озон (все остальные продукты бара → позже вычисляем)
const barOzon = [
"арахисовая паста",
"ванильная эссенция",
"ванильный сахар",
"какао-порошок",
"кленовый сироп",
"кокосовая стружка",
"кокосовое молоко",
"кокосовый сорбет",
"кофе зерно фильтр",
"кофе эспрессо зерно",
"лавка сушеная",
"малина сублимированная",
"матча голубая",
"матча зеленая",
"миндальное молоко",
"молоко",
"молоко безлактозное",
"облепиха",
"овсяное молоко",
"пряности для кофе",
"сливки 10%",
"фундуковое молоко",
"чай улун",
"чай эрл грей",
"чай сенча",
"чай травяной",
"чай чабрец",
"чай черный",
"чай ягодно-фруктовый",
"черника сублимированная",
"имбирь сушеный",
"корица",
"пюре облепиха",
"пюре яблоко",
"чай пуэр",
];



// --- Общие списки категорий в порядке отображения ---

const kitchenCategories = [
    { title: "▶️ Продстар", items: kitchenProdstar },
    { title: "▶️ Купер", items: kitchenKuper },
    { title: "▶️ Продукты на суп", items: kitchenSoup },
];

const barCategories = [
    { title: "▶️ Оля", items: barOzon }, 
    { title: "▶️ Купер", items: barKuper },
];


// --- ВЫБРАННЫЕ ТОВАРЫ ---
let selected = {
    kitchen: new Set(),
    bar: new Set(),
};


// --- ФИЛЬТРАЦИЯ ---
function filterProducts(tab) {
    const query = document.getElementById("search" + (tab === "kitchen" ? "Kitchen" : "Bar")).value.toLowerCase();
    renderList(tab, query);
}


function renderList(tab, search = "") {
    const listId = tab === "kitchen" ? "listKitchen" : "listBar";
    const container = document.getElementById(listId);
    container.innerHTML = "";

    const categories = tab === "kitchen" ? kitchenCategories : barCategories;

    categories.forEach(cat => {
        // Заголовок категории
        const h = document.createElement("div");
        h.className = "product-item product-header";
        h.textContent = cat.title;
        container.appendChild(h);

        // Товары категории
        cat.items.forEach(item => {
            if (search && !item.toLowerCase().includes(search)) return;

            const row = document.createElement("div");
            row.className = "product-item";

            const id = tab + "_" + item.replace(/\s+/g, "_");

            row.innerHTML = `
                <input type="checkbox" id="${id}" ${selected[tab].has(item) ? "checked" : ""} 
                    onchange="toggleItem('${tab}','${item}')">
                <label for="${id}">${item}</label>
            `;
            container.appendChild(row);
        });
    });
}


// --- ПЕРЕКЛЮЧЕНИЕ ВКЛАДОК ---
function switchTab(tab) {
    document.getElementById("kitchen").style.display = tab === "kitchen" ? "block" : "none";
    document.getElementById("bar").style.display = tab === "bar" ? "block" : "none";

    document.querySelectorAll(".tab").forEach(el => el.classList.remove("active"));
    document.querySelector(".tab:nth-child(" + (tab === "kitchen" ? "1" : "2") + ")").classList.add("active");
}


// --- ОБРАБОТКА ВЫБОРА ---
function toggleItem(tab, item) {
    if (selected[tab].has(item)) selected[tab].delete(item);
    else selected[tab].add(item);

    save();
    renderSelected(tab);
}


// --- ВЫВОД ВЫБРАННЫХ ПО КАТЕГОРИЯМ ---
function renderSelected(tab) {
    const out = document.getElementById(tab === "kitchen" ? "selectedKitchen" : "selectedBar");

    if (selected[tab].size === 0) {
        out.innerHTML = "Нет выбранных продуктов";
        return;
    }

    const categories = tab === "kitchen" ? kitchenCategories : barCategories;

    let html = "";

    categories.forEach(cat => {
        // Проверяем: есть ли выбранные внутри категории?
        const chosen = cat.items.filter(x => selected[tab].has(x));
        if (chosen.length === 0) return;

        html += `<div style="margin-top:10px;font-weight:bold;color:#666;">${cat.title}</div>`;
        chosen.forEach(item => html += `<div>• ${item}</div>`);
    });

    out.innerHTML = html;
}


// --- КОПИРОВАНИЕ ---
function copySelected(tab) {
    if (selected[tab].size === 0) {
        toast("Нет выбранных продуктов");
        return;
    }

    const categories = tab === "kitchen" ? kitchenCategories : barCategories;

    let text = "";
    categories.forEach(cat => {
        const chosen = cat.items.filter(x => selected[tab].has(x));
        if (!chosen.length) return;

        text += `${cat.title}\n`;
        chosen.forEach(i => text += `• ${i}\n`);
        text += "\n";
    });

    navigator.clipboard.writeText(text.trim())
        .then(() => toast("Список скопирован!"))
        .catch(() => toast("Не удалось скопировать"));
}


// --- ОЧИСТКА ---
function clearAll(tab) {
    selected[tab].clear();
    save();
    renderList(tab);
    renderSelected(tab);
}


// --- LOCALSTORAGE ---
function save() {
    localStorage.setItem("selectedKitchen", JSON.stringify([...selected.kitchen]));
    localStorage.setItem("selectedBar", JSON.stringify([...selected.bar]));
}

function load() {
    const k = JSON.parse(localStorage.getItem("selectedKitchen") || "[]");
    const b = JSON.parse(localStorage.getItem("selectedBar") || "[]");

    selected.kitchen = new Set(k);
    selected.bar = new Set(b);
}


// --- TOAST ---
function toast(text) {
    const t = document.getElementById("toast");
    t.textContent = text;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2000);
}


// --- PWA: ДЕЖУРНАЯ ЧАСТЬ (оставлена из твоего файла) ---
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
        .catch(e => console.log("SW error:", e));
}



// --- ИНИЦИАЛИЗАЦИЯ ---

renderList("kitchen");
renderList("bar");
renderSelected("kitchen");
renderSelected("bar");

</script>

</body>
</html>
